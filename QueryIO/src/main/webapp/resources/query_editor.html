<link rel="stylesheet" href="styles/nd.css" type="text/css" />
<link rel="stylesheet" href="styles/data_analyzer.css" type="text/css" />

<script type="text/javascript" src="scripts/data_analyzerTab.js"></script>

<script type="text/javascript" src="scripts/query_manager.js"></script>

<div class="queryHeader" style="text-align: left; margin-top: 8px;">
	<img id="expandQueryDesign" src="images/Right.png"
		style="display: none; height: 15px;"> <img
		id="shrinkQueryDesign" src="images/Down.png" style="height: 15px;">
	<span style="margin-left: 5px;">Query Builder</span>
</div>
<div id="divQueryID" class="designBackground">
			<table style="width: 100%;">
				<tbody>
					<tr>
						<td style="width: 8%; padding-left: 1%;">Query Id</td>
						<td style="width: 20%;"><input type="search"
							placeholder="Query Id" value="New Query 1" id="queryId" style="width: 90%;" onkeyup="javascript:QM.queryIdChanged();" >
						</td>

						<td style="width: 2%; text-align: left;">Description</td>
						<td><input type="search" placeholder="Query Description"
							id="queryDesc" style="width: 95%;"> 
						</td>
						
					</tr>
				</tbody>
			</table>
		</div>
<div id="rightPart" class="designBackground">
<div style="height: auto;">
	<table>
		<tr style="display: none;">
			<td nowrap="nowrap"><span
				style="margin-left: 10px; margin-right: 5px">Query Id: </span></td>
			<td nowrap="nowrap" style="width: 10%"><input type='search'
				placeholder="Query Id" id="queryId" style="width: 100%"> <span
				style="color: red; margin-left: 0px; vertical-align: top">*</span></td>

			<td nowrap="nowrap"><span
				style="margin-left: 10px; margin-right: 5px">Query Title: </span></td>
			<td nowrap="nowrap" style="width: 90%"><input type='search'
				placeholder="Query Name" id="queryName" style="width: 100%">
				<span style="color: red; margin-left: 0px; vertical-align: top">*</span>
			</td>
		</tr>
	</table>
</div>
<div id="sql_query_builder_div" style="height: auto;"></div>
<ul id="query_builder_tab" style="display: none;">
	<li id="sql_query_builder_li"><a
		href="javascript:DataAnalyzer.showTab('1');">SQL Query Builder</a></li>
	<li id="gui_query_builder_li" class="deactive"><a
		href="javascript:DataAnalyzer.showTab('2');">Graphical Query
			Builder</a></li>
</ul>

<div id="graphical_query_builder_div" style="height: auto; display:">

	<table id="element_table"
		style="width: 100%; padding: 0px; font-size: 9pt;">
		<tr>
			<td style="width: 7%; text-align: left;">Database</td>
			<td style="width: 10%;"><select id="queryIODatabase"
				onchange="javascript:QM.changeQueryIODbName(this.options[this.selectedIndex].value);">
			</select></td>
			<td colspan="7">
				<table id="query_filter_table"
					style="visibility: hidden; width: 100%;">
					<tr>
						<td style="width: 15%;"><input type="checkbox"
							id="is_apply_query_filter"
							onclick="javascript:QM.applyQueryFilter();"> Input Path
							Filter</td>
						<td><span class="sbox" style=""> <input type="search"
								id="query_filter_sql" onclick="QM.showQueryFilterDiv(true);"
								onfocus="QM.showQueryFilterDiv(true);"
								style="width: 100%; visibility: hidden;" readonly></span>

							<div id="query_filter_div" class="filtersBlock"
								style="display: none; width: 65%;">
								<span>Result of this query will be passed as input path
									for hive query.</span> <span id="selectColClose" class="divcloser">
									<a href="javascript:QM.showQueryFilterDiv(false);"><img
										src="images/light-box-close.png" class="closerImage"></a>
								</span>
								<table style="width: 100%;">
									<tr>
										<td style="width: 7%;">SELECT</td>
										<td>filepath</td>
									</tr>
									<tr>
										<td style="width: 7%;">FROM</td>
										<td><span class="sbox"><input type="search"
												id="query_filter_tables" placeholder="From Tables..."
												onfocus="QM.showQueryFilterTables(true);"
												onclick="QM.showQueryFilterTables(true);"
												style="width: 100%; float: left; overflow: auto;" readonly></span>
											<div id="query_filter_tables_div" class="filtersBlock"
												style="display: none;">
												<span>Search On:</span><br>
											</div></td>
									</tr>
									<tr>
										<td style="width: 7%;">WHERE</td>
										<td><span class="sbox"><input type="search"
												id="query_filter_where" placeholder="Where..."
												onfocus="QM.showQueryFilterWhere(true);"
												onclick="QM.showQueryFilterWhere(true);"
												style="width: 100%; float: left; overflow: auto;" readonly></span>
											<div id="query_filter_where_div" class="filtersBlock"
												style="display: none;">
												<span>Search On:</span><br>
											</div></td>
									</tr>
								</table>
							</div></td>
					</tr>
				</table>
			</td>

		</tr>
		<tr>
			<td style="width: 7%;" nowrap="nowrap"><label>SELECT</label></td>
			<td nowrap="nowrap" colspan="8"><span class="sbox" style=""><input
					type="search" id="srch_col_fld" placeholder="Select Column..."
					results="0" onclick="QM.showColFilters(this);"
					onfocus="QM.showColFilters(this);" style="width: 100%;" readonly></span>
				<div id="searchColFilters" class="filtersBlock"
					style="display: none;">
					<span>Search On:</span><br>
				</div></td>
		</tr>


		<tr>
			<td nowrap="nowrap"><label style="width: 80px; margin-right: 5px;">FROM</label></td>
			<td nowrap="nowrap" colspan="6"><span class="sbox"><input
					type="search" id="srch_from_fld" placeholder="From Tables..."
					results="0" onfocus="QM.showFromFilters(this);"
					onclick="QM.showFromFilters(this);"
					style="width: 100%; float: left; overflow: auto;" readonly></span>
				<div id="searchFromFilters" class="filtersBlock"
					style="display: none;">
					<span>Search On:</span><br>
				</div></td>

			<td id="resultTableNameTD" nowrap="nowrap" colspan="2"
				style="width: 25%; display: none;"><span> <input
					type="checkbox" id="persist" value="Persist"
					onclick="QM.persistClicked(this.checked);"> <span>Persist
						Result&nbsp;&nbsp; | &nbsp;</span>
			</span> <span id="resultTableNameSpan" style="width: auto;"> <span>Result
						Table &nbsp;&nbsp;&nbsp;&nbsp;</span> <input type="search"
					id="resultTableName" placeholder="Result Table Name" results="0"
					 style="width: 200px;">
			</span></td>
		</tr>

		<!-- Start of where  -->
		<tr>

			<td nowrap="nowrap">
				WHERE
			</td>


			<td id="where_select_td" style="" colspan="8"><span class="sbox"
				style=""><input type="search" id="where_col"
					placeholder="Where..." results="0" onclick="QM.showWhereCol(this);"
					onfocus="QM.showWhereCol(this);" style="width: 100%;" readonly></span>
				<div id="whereFilters" class="filtersBlock" style="display: none;">
					<span>WHERE:</span><br>

				</div></td>




		</tr>
		<tr>
			<td style="width: 5%;" nowrap="nowrap">
				GROUP BY
				<button class="button" style="display: none;">GROUP BY</button>
			</td>
			<td id="group_by_select_td" style="" colspan="8"><span
				class="sbox" style=""><input type="search" id="grp_by_col"
					placeholder="Group By..." results="0"
					onclick="QM.showGroupByCol(this);"
					onfocus="QM.showGroupByCol(this);" style="width: 100%;" readonly></span>
				<div id="groupByColFilters" class="filtersBlock"
					style="display: none;">
					<span>Search On:</span><br>

				</div></td>
		</tr>

		<!-- HAVING clause -->
		<tr>
			<td><label>HAVING</label></td>
			<td colspan="8"><span class="sbox" style=""> <input
					type="search" id="having_col" placeholder="Having..." results="0"
					onclick="QM.showHavingCol(this);" onfocus="QM.showHavingCol(this);"
					style="width: 100%;" readonly>
			</span>
				<div id="havingColFilters" class="filtersBlock"
					style="display: none;">
					<span>Search On:</span><br>
				</div></td>
		</tr>

		<tr>
			<td style="width: 5%;" nowrap="nowrap">
				ORDER BY
			</td>
			<td id="order_by_select_td" style="" colspan="8"><span
				class="sbox" style=""><input type="search" id="order_by_col"
					placeholder="Order By..." results="0"
					onclick="QM.showOrderByCol(this);"
					onfocus="QM.showOrderByCol(this);" style="width: 100%;" readonly></span>
				<div id="orderByColFilters" class="filtersBlock"
					style="display: none;">
					<span>ORDER BY:</span><br>

				</div></td>
		</tr>

		<tr>
			<td nowrap="nowrap" style="width: 7%;"><span>SQL Query </span></td>
			<td colspan="8"><textarea id="query_textarea" rows="" cols=""
					style="width: 100%; height: 100%; margin-top: 10px;"
					onchange="QM.checkQueryEmpty();"></textarea></td>
		</tr>
	</table>
</div>

<button class="button" type="button" style="margin-right: 10px; padding: 4px;" id="lineClear" name="Clear" onclick="clearQuery();">Clear</button>
<button class="button" type="button" style="margin-right: 10px; padding: 4px;" id="lineSave" name="Save" onclick="QM.saveQuery();">Save</button>
</div>

<script>

function clearQuery(){
	$("#srch_col_fld").val('');
	$("#srch_from_fld").val('');
	$("#persist").val('');
	$("#resultTableName").val('');
	$("#where_col").val('');
	$("#grp_by_col").val('');
	$("#having_col").val('');
	$("#order_by_col").val('');
	$("#query_textarea").val('');
};


var colList=[];
var currentDesignerType = "";
QM.readyQEdit();
QM.setQueryDirtyBitHandlerEvent();
	
var chartPosition='';
function fillPopUp(flag)
{
	var id = QM.selectedQueryId;
	
	dwr.util.cloneNode('pop.pattern',{ idSuffix: id});
	dwr.util.byId('pop.pattern'+id).style.display = '';
	dwr.util.byId('popup.image.processing'+id).style.display = '';
	dwr.util.setValue('popup.component','Query ID');
	dwr.util.setValue('popup.host'+id,id);
	dwr.util.setValue('popup.message'+id,'Processing Request...');
	
	if (QM.isDelete){
		dwr.util.setValue('popup.status'+id,'Deleting..');
	}
	else if(QM.isClone)
	{
		dwr.util.setValue('popup.status'+id,'Cloning..');	
		RemoteManager.saveQuery(QM.selectedQueryId, '', QM.selectedNameNode, QM.selectedDbName, '', QM.query, QM.querySaveResponse);
		QM.isClone = false;
	}
	else{
		dwr.util.setValue('popup.status'+id,'Saving..');
		RemoteManager.saveQuery(QM.selectedQueryId, '', QM.selectedNameNode, QM.selectedDbName, '', QM.query, QM.querySaveResponse);
	}
	
}

function closePopUpBox()
{
    QM.closeBox(true);
}

function getOnlyAlphaNumericValues(event)
{	
	    var cod = event.which;
	    var code = String.fromCharCode(cod);
	    var controlKeys = [8, 9, 32 ,0];
	    var isControlKey = controlKeys.join(",").match(new RegExp(event.which));
    	if((code>='A' && code<='Z')||(code>='0' && code<='9') || (code>='a' && code<='z') || (code>=35 && code<=40) || isControlKey ){
    		return;
    	}
    	else{
    		event.preventDefault();
    	}
	}
	
QM.totalQuery = $('select#queryIds option').length+1;
$('#queryId').val("New Query "+QM.checkID(QM.totalQuery ));
$('#queryIdTitle').text($('#queryId').val());
$("#design_link").text("Design: "+$("#queryId").val());
$("#preview_span").text("Preview: "+$("#queryId").val());

if(QM.totalQuery==1) {
	Navbar.isAddNewQuery = true;
}
if(Navbar.isAddNewQuery){
	DAT.tempQuery=$('#queryId').val();
	QM.isNewQuery=true;
	QM.selectedQueryId = $('#queryId').val();
}else{
	QM.isNewQuery=false;
}

</script>

<script src="scripts/dropdown.textbox.js"></script>